---
title: "GEOG458_GroupLab1"
author: "Group6"
date: "1/16/2019"
output: html_document
---

##Section 1, Question 1
Beijing and Shanghai are considered as "Direct Controlled Municipality", which means they are not a province, and are directly controlled or managed by the chinese central government. Hong Kong, Macao, and Taiwan are missing from the dataset. This is because the Chinese centrol government allowed them to have their own government. However, their own government will be managed by the Chinese centrol government. Using Hong Kong as an example, Hong Kong has it own government called Hong Kong SAR Government, and the adminitrive head is called cheif executive. The chief executive will be selected by the Hong Kong residences. After the candidate is finalized, the Chinese government will review his qualifications. Once approved, he/she will be the formal cheif executive of Hong Kong. Some people may argue whether Taiwan is still part of China. The answer is yes, but so far the Taiwan government doesn't recognize the Chinese Communism Party as the leader of their government. The [1992 Consensus](https://en.wikipedia.org/wiki/1992_Consensus) can be the support of this claim. 

##Section 1, Question 2
China's economic growth has always been questioned by others because from a third-party perspective, we are unsure of how China was able to recover.  China has really impressive statistics when it comes to their GDP.  In 2017, they had a 6.9% growth and also had about 30% of global economic growth.  The Chinese government claim that they have entered into a new economic phase that is more domestic-centered and responsive to popular goods.  But according to [Economic Front](https://economicfront.wordpress.com/2018/06/05/the-chinese-economy-problems-and-prospects/), there is a graph that shows China's growth rate between 2011 to 2016 actually dropped significantly before the growth in 2017.  There were cases that GPD data was manipulated to attempt to meet standards, such as Inner Mongolia admitted to falsifying data back in 2016.

In [China's Economic Data: An Accurate Refelction, or Just Smoke and Mirrors](https://www.stlouisfed.org/publications/regional-economist/second-quarter-2017/chinas-economic-data-an-accurate-reflection-or-just-smoke-and-mirrors ), they have a few suggestions to help collect *better* GPD.  They have three mothods that we can consder; energy consumption, indexed GDP proxies, and luminosity.  Because China does consume a lot of energy, changes in this particular area could help collect data.  We can think of it as China consumes energy to make products which can be recording as production.  A second method, indexed GDP proxies.  Indexing will measure from quarter-to-quarter but with consistency it can show quarterly growth to yearly growth.  The last method is luminsoity and that means to use satellite data that will measure the intensity of man-made night lights.  This method is can avoid falsification and misreporting because this method would be able to track consumption of all goods that requires light.  



##Section 2, Question 1
```{r task2.1,echo=TRUE, warning=FALSE,message=FALSE}
library(plyr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(reshape2)
object1 = read.csv("China_EO_49to17.csv" ,fileEncoding="latin1")
object2 = as.tibble(object1)
datC=object2
datC$Year=seq(from=1949, to=2017)
datC=datC[order(datC$Year),]
# substitute years to numerical data
datC
outp = cbind(datC[,1],datC[,grep("Output", names(datC))])
enterp = cbind(datC[,1],datC[,grep("Enterprise", names(datC))])
enterp
outp_P = nrow(outp)-1
colnames(outp) <- strsplit((colnames(outp)),"_Output")
outp
colnames(enterp) <- strsplit((colnames(enterp)),"_Output")
enterp
outp_4<- outp %>%
  select(Beijing,Tianjin,Chongqing,Shanghai, Year)
##rename the columns
names(outp_4) <- c("Beijing", "Tianjin", "Chongqing", "Shanghai", "Year")
## melt the tibble object to a tall structure for plotting purpose
meltout4 <- melt(outp_4, id.vars = "Year")
##plot. Different cities will have different color; applying smoothed linear regression lines with 95% confidence area
bb <- ggplot(meltout4, aes(x = Year, y = value, colour = variable)) + geom_point() + scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 3)) + labs(title = "Output of 4 Municipalities", x = "Year",y = "Output")
bb
```

##Section 2, Question 2. One of the five visualizations

```{r setup, echo=TRUE, warning=FALSE,message=FALSE, fig.width=12,fig.height=6}
library(plyr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(reshape2)

## import the csv file as tibble object
econData <- as_tibble(read.csv("China_EO_49to17.csv"))

##only interested in the enterprise data in those direct controlled cities after year 2000
DirectCity<- econData %>%
  select(Beijing_Enterprise, Shanghai_Enterprise, Tianjin_Enterprise, Chongqing_Enterprise, Year)%>%
  filter(Year >= 2000)

##rename the columns
names(DirectCity) <- c("Beijing", "Shanghai", "Tianjin", "Chongqing", "Year")

## melt the tibble object to a tall structure for plotting purpose
meltDirectCity <- melt(DirectCity, id.vars = "Year")

##plot. Different cities will have different color; applying smoothed linear regression lines with 95% confidence area
ggplot(meltDirectCity, aes(x = Year, y = value, colour = variable)) + geom_point() + scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 3))


```

##Section 2, Question 2. Second Visualization (Jody)

```{r setup, echo=TRUE}
## looking at enterprises of different cities.

# read the file 
object1=read.csv("China_EO_49to17.csv", fileEncoding="latin1")
econData=as_tibble(object1)

# had to recreate the year column
desc <- arrange(econData, desc(Year))

# added to the table
Year=seq(from=1949, to=2017)
econData$Year=Year

# grabbed a few cities and its enterprise filters between 2000 to 2017
DataCity <- econData %>%
  select(Anhui_Enterprise, Hebei_Enterprise, Xinjiang_Enterprise, Year)%>%
  filter(Year >= 2000)

meltDataCity <- melt(DataCity, id.vars = "Year")

ggplot(meltDataCity, aes(x = Year, y = value, colour = variable)) + geom_point() + scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = FALSE)

```

##Section 3, Question 1. Producing Output Ratios

```{r, echo = TRUE, warning=FALSE,message=FALSE}

# comparing Guangdong and Liaoning's enterprise
GuangdongLiaoning<- econData %>%
  select(Guangdong_Enterprise, Liaoning_Enterprise, Year)%>%
  filter(Year >= 2000)
names(GuangdongLiaoning) <- c("Guangdong", "Liaoning", "Year")
add_column(GuangdongLiaoning, Output_Ratio = 0)
print(mutate(GuangdongLiaoning, Output_Ratio = Guangdong/Liaoning))

meltGuangdongLiaoning <- melt(GuangdongLiaoning, id.vars = "Year")

ggplot(meltGuangdongLiaoning, aes(x = Year, y = value, colour = variable)) + geom_point() + scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = FALSE)

```
#Guangdong vs. Liaoning 
We can see that Guangdong was able to stable themselves in the earlies 2010 wheres compared to Liaoning they have dropped.

```{r, echo = TRUE, warning=FALSE,message=FALSE}

# comparing Jilin and Anhui's enterprise
JilinAnhui<- econData %>%
  select(Jilin_Enterprise, Anhui_Enterprise, Year)%>%
  filter(Year >= 2000)
names(JilinAnhui) <- c("Jilin", "Anhui", "Year")
add_column(JilinAnhui, Output_Ratio = 0)
print(mutate(JilinAnhui, Output_Ratio = Jilin/Anhui))

meltJilinAnhui <- melt(JilinAnhui, id.vars = "Year")

ggplot(meltJilinAnhui, aes(x = Year, y = value, colour = variable)) + geom_point() + scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = FALSE)

```
#Jilin vs. Anhui 
We can see that Anhui has grown increasingly high and Jilin has a much less smaller slope.

```{r, echo = TRUE, warning=FALSE,message=FALSE}

# comparing Fujian and Guizhou's enterprise
FujianGuizhou<- econData %>%
  select(Fujian_Enterprise, Guizhou_Enterprise, Year)%>%
  filter(Year >= 2000)
names(FujianGuizhou) <- c("Fujian", "Guizhou", "Year")
add_column(FujianGuizhou, Output_Ratio = 0)
print(mutate(FujianGuizhou, Output_Ratio = Fujian/Guizhou))

meltFujianGuizhou <- melt(FujianGuizhou, id.vars = "Year")

ggplot(meltFujianGuizhou, aes(x = Year, y = value, colour = variable)) + geom_point() + scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = FALSE)

```
#Fujian vs. Guizhou 
We can see that Fujian has a larger growth compared to Guizhou and we can say that maybe sometime in the future they would at one point have the same value.


##Section 3, question 2
```{r, echo=TRUE, fig.width=14,fig.height=7}

##Sum national total 
NationalOutput <- econData %>%
  select(matches("output"), Year) %>%
  mutate(sumVar=rowSums(.[1:19], na.rm = TRUE))

##Inner join national total with the csv file
# 
# df_with_Total<- left_join(econData, NationalOutput, by = "Year")
# df_with_Total<- df_with_Total %>%
#   select(-matches(".y"))

##trying to building a new data frame to store the percentage


##the actual loop. 

## convert to tibble object
NationalOutput <- as_tibble(NationalOutput)

##using R base functions to create new columns with the ratio between the summarized national output and each province
for(col in names(NationalOutput)) {
  NationalOutput[paste0(col, "_share")] = NationalOutput[col] / NationalOutput$sumVar
}

## subset the previous dataset for plotting purposes. 

## only selecting the ratio columns which has the _share pattern
subset_NationalOutput <- select(NationalOutput, matches("share"))

## deleting useless columns, such as year ratio
subset_NationalOutput <- subset_NationalOutput[,1:31]

## adding the actual year column
subset_NationalOutput<-add_column(subset_NationalOutput, NationalOutput$Year)

## reassign the year column with a new name
colnames(subset_NationalOutput)[32]<-"Year"

##melt the tibble object to a tall structure 
melt_subNational <- melt(subset_NationalOutput, id.vars = "Year")

##plot 
ggplot(melt_subNational, aes(x = Year, y = value, colour = variable)) + geom_point()



```


##Section 3, Question 4
```{r task3.4}
library(tidyverse)
library(dplyr)
library(ggplot2)
object3 = read.csv("Municip_output.csv",stringsAsFactors = FALSE)
municp = as.tibble(object3)
munip <- municp
allc_muni <- outp[50:69,]
allc_muni <- allc_muni[,c(1:3, 23, 10) ]
for (i in 1:5) {
  if(i >1){
    munip[,i]<- (municp[,i] - allc_muni[,i])
  }
}
# calculate output difference between National Bureau of Statistics of China and All China Center Data. If the number is positive (bar above x axis on the graph), that means that, for the same year, China NBS data is higher than the data collected by All China Center

pB <-ggplot(munip, aes(Year, Beijing))  
pB +geom_bar(stat = "identity")+geom_line(aes(x = munip$Year, y = Beijing),colour = "darkred")+
  labs(title = "Statistics Difference of Beijing Output",substitute("National Bureau of Statistics of China - ALl China Center Data"), x = "Year",y = "Output (Thousand Million CNY)")

pT <-ggplot(munip, aes(Year, Tianjin))
pT +geom_bar(stat = "identity")+geom_line(aes(x = munip$Year, y = Tianjin),colour = "darkblue")+
  labs(title = "Statistics Difference of Tianjin Output",substitute("National Bureau of Statistics of China - ALl China Center Data"), x = "Year",y = "Output (Thousand Million CNY)")

pC <-ggplot(munip, aes(Year, Chongqing))
pC +geom_bar(stat = "identity")+geom_line(aes(x = munip$Year, y = Chongqing),colour = "grey60")+
  labs(title = "Statistics Difference of Chongqing Output",substitute("National Bureau of Statistics of China - ALl China Center Data"), x = "Year",y = "Output (Thousand Million CNY)")

pS <-ggplot(munip, aes(Year, Shanghai))
pT +geom_bar(stat = "identity")+geom_line(aes(x = munip$Year, y = Shanghai),colour = "lightsalmon4")+
  labs(title = "Statistics Difference of Shanghai Output",substitute("National Bureau of Statistics of China - ALl China Center Data"), x = "Year",y = "Output (Thousand Million CNY)")

#print four graphs of differences of the four municipalities
```

##Section 3, Question 5

```{r visualation 1}
library(plyr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(reshape2)

## import the csv file as tibble object
ecData <-as_tibble(read.csv("China_EO_49to17.csv"))


##only interested in the enterprise data in those direct controlled cities after year 2000
China <- ecData %>%
  select(Beijing_Output, Shanghai_Output, Tianjin_Output, Guizhou_Output, Yunnan_Output, Gansu_Output, Year)%>%
  filter(Year >= 2000)
  
##rename the columns
names(China) <- c("Beijing", "Shanghai", "Tianjin", "Guizhou", "Yunnan", "Gansu", "Year")

## melt the tibble object to a tall structure for plotting purpose
Chinaa <- melt(China, id.vars = "Year")

##ploting the values
ggplot(data=Chinaa,aes(x=Year,y=value,colour=variable))+geom_point(color="black",pch=20,size=4)+ggtitle("Outputs of 3 of the Richest and Poorest China Provinces (in GDP per capita for 2017) from 2000-2017")+theme_bw()+ scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 5), se = FALSE)
```
##Explanation of the plot
This plot shows that while the richest and poorest provinces outputs (based on 2017 data for GDP per capita) in China have been increased over the years, the outputs between provinces has widen considerably. Thus the data suggests that there is a widening gap in wealth between richest and poorest provinces. However, this assertion should be taken with a grain of salt (in consideration of how wide the gap is) as China provinces have been historically inflating their reported figures over the years. Still, there seems to be a trend that China has growing gap in outputs between different provinces, thus suggesting a correlation with the wealth gap as well (which is one of key issues in China).

```{r visualation 2}
library(plyr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(reshape2)

## import the csv file as tibble object
ecData <-as_tibble(read.csv("China_EO_49to17.csv"))

##only interested in the enterprise data in those direct controlled cities after year 2000
China <- ecData %>%
  select(Beijing_Enterprise, Shanghai_Enterprise, Tianjin_Enterprise, Guizhou_Enterprise, Yunnan_Enterprise, Gansu_Enterprise, Year)%>%
  filter(Year >= 2000)
  
##rename the columns  
names(China) <- c("Beijing", "Shanghai", "Tianjin", "Guizhou", "Yunnan", "Gansu", "Year")


## melt the tibble object to a tall structure for plotting purpose
Chinaa <- melt(China, id.vars = "Year")

##ploting the values
ggplot(data=Chinaa,aes(x=Year,y=value,colour=variable))+geom_point(color="purple",pch=19,size=3)+ggtitle("Enterprises of 3 of the Richest and Poorest China Provinces (in GDP per capita for 2017) from 2000-2017")+theme_bw()+ scale_size_area()+ stat_smooth(method = lm, formula = y ~ splines::bs(x, 5), se = FALSE)
```
##Explanation of the plot
On the other hand, the number of enterprises have little gap between the provinces (regardless of their wealth gap), excluding Shanghai. The small differences between these provinces may have to do with the number of state-owned enterprises (a legal entity that takes in commerical activity on behalf of the government), which could mean that they are not as affected by the wealth of the surrounding provinces in terms of location. Shanghai may be an exception here because it is much wealthier, thus could attract more enterprises to the area. However, this is simply a guess as other variables, such as population, can affect the number of enterprises. 

